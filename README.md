# omni_data_docs

---

# Обзор

Бекенд-сервер предназначен для управления образовательными курсами, лекциями, заданиями, вопросами и попытками их прохождения. Основные функции сервера включают:
- Управление курсами, лекциями, заданиями и вопросами (создание, изменение, удаление и получение по массиву id).
- Управление участниками курса: добавление/удаление пользователей, назначение и отзыв статуса модератора (преподавателя). В курсе допускается только один владелец, а у каждого пользователя может быть только один статус (студент, модератор или владелец).
- Управление попытками прохождения заданий: создание новой попытки, обновление (отвечание на вопросы), завершение попытки, а также выставление оценок.
- Обеспечение версионности вопросов – при изменении вопроса новая версия сохраняется, при этом предыдущие версии остаются в массиве.

---

# Структура данных

Во время запроса данных, сервер должен возвращать их в таком виде:

### Course
```json
{
  "id":0,// id 
  "title": "Programming",
  "description": "здесь вы изучите много интересного",
  "createDate": 1800000000, // время создания (секунды)
  "users": [
    [/* id студентов в формате строки */],
    [/* id модераторов в формате строки */]
  ],
  "owner": "", // id владельца курса (строка)
  "lectures": [/* id лекций в формате чисел */],
  "tasks": [/* id заданий в формате чисел */]
}
```

### Lecture
```json
{
  "id":0,// id 
  "title": "1 Лекция",
  "data": {}, // данные лекции: текст, файлы, тип редактора и т.д.
  "createDate": 1800000000, // время создания (секунды)
  "active": true, // статус активности лекции
  "creator": "", // id создателя (строка)
  "users": [/* id пользователей, которым доступна лекция. Если ['all'] – доступна всем */],
  "course": 2 // id курса (число)
}
```

### Task (Задание)
```json
{
  "id":0,// id 
  "title": "Задание",
  "data": [{ /* версия 1 задания */ },
            { /* версия 2 задания */ },
            { /* версия 3 задания */ }
], // структура: список вопросов, файлы и пр.
  "createDate": 1810000000, // время создания (секунды)
  "active": true, // активность задания
  "attempts": 1, // количество попыток (-1 означает отсутствие ограничения)
  "startDate": 1815000000, // время начала, после которого можно начинать попытку (-1 – доступно сразу)
  "endDate": 1816000000, // время окончания попытки (-1 – без ограничения)
  "creator": "", // id создателя (строка)
  "users": [/* id пользователей, которым доступно задание. Если ['all'] – доступно всем */],
  "course": 2 // id курса, к которому относится задание (число)
}
```

### Question
```json
{
  "id":0,// id 
  "data": [
    {}, // 1-я версия вопроса
    {}, // 2-я версия вопроса
    {}  // 3-я версия вопроса и т.д.
  ],
  "createDate": 1800000000, // время создания (секунды)
  "creator": 3, // id создателя (число)
  "course": 4 // id курса (число)
}
```

### Attempt (Попытка)
```json
{
  "id":0,// id 
  "data": {}, // структура, содержащая ответы на задание
  "startDate": 1810000000, // время начала попытки (секунды)
  "endDate": 1816000000, // время окончания попытки (секунды, если попытка активна – -1)
  "finished": true, // статус завершенности попытки
  "user": "", // id студента (строка)
  "task": 3, // id задания (число)
  "course": 2 // id курса (число)
}
```

---

# API Endpoints

Все эндпоинты используют формат JSON для запросов и ответов.

## 1. Работа с курсами

### Создание курса
- **Метод:** `POST`
- **URL:** `/course/create`
- **Тело запроса:**
  ```json
  {
    "title": "Programming",
    "description": "здесь вы изучите много интересного",
    "owner": "<owner_id>",
    "createDate": 1800000000
  }
  ```
- **Ответ:**
  ```json
  {
    "id": 1
  }
  ```
- **Ошибки:** 400 (невалидные данные).

### Изменение курса
- **Метод:** `PUT`
- **URL:** `/course/update`
- **Тело запроса:**
  Здесь присутсвуют поля которые нужно изменить, т.е. поля кроме title и description изменять не нужно
  ```json
  {
    "id": <id курса>,
    "title": "Programming",
    "description": "здесь вы изучите много интересного",
  }
  ```
- **Ответ:**
  ```json
  {
    "id": 567, // id курса
  }
  ```
- **Ошибки:** 400.

### Удаление курса
- **Метод:** `POST`
- **Тело запроса:**
  ```json
  {
   "id": 567, // id курса
  }
  ```
- **URL:** `/course/delete`
- **Ответ:**
  ```json
  {
   "id": 567, // id курса
  }
  ```
- **Ошибки:** 400.

  
### Получение данных по массиву id курсов
- **Метод:** `POST`
- **URL:** `/course/get`
- **Тело запроса:**
  ```json
  [
    id1, id2, id3 
  ]
  ```
- **Ответ:** сообщение об успешном удалении.
  ```json
  [
  {
    "id":0,// id 
    "title": "Programming",
    "description": "здесь вы изучите много интересного",
    "createDate": 1800000000, // время создания (секунды)
    "users": [
      [/* id студентов в формате строки */],
      [/* id модераторов в формате строки */]
    ],
    "owner": "", // id владельца курса (строка)
    "lectures": [/* id лекций в формате строки */],
    "tasks": [/* id заданий в формате строки */]
  },
  {
  ...
  }
  ]
  ```
- **Ответ:** массив объектов курсов.
- **Ошибки:** 400.

> Если не существует курса с определенным id, то в массве ответов на на его индексе должен быть пустой объект
> Пример, допустим не был найден объект с id 56 и в массиве он был 5 по порядку
> ```json
> [
> {...},
> { "id":56}, //тогда этот объект тоже должен быть 5 по счету 
> {...}
> ]
> ```

---

## 2. Работа с лекциями

### Создание лекции
- **Метод:** `POST`
- **URL:** `/lecture/create`
- **Тело запроса:**
  ```json
  {
    "title": "1 Лекция",
    "data": { /* контент лекции */ },
    "course": <course_id>,
    "activate": true,
    "users": [/* id пользователей, которым доступна лекция. Если ['all'] – доступна всем */],
    "creator": "<user_id>"
  }
  ```
- **Ответ:**
  ```json
  {
    "id": 1 //id лекции
  }
  ```
- **Ошибки:** 400.

### Изменение лекции
- **Метод:** `PUT`
- **URL:** `/lecture/update`
- **Тело запроса:**
  ```json
  {
    "id": <id лекции>,
    "title": "1 Лекция",
    "data": { /* контент лекции */ },
  }
  ```
- **Ответ:** обновленные данные лекции.
- **Ошибки:** 400.

### Удаление лекции
- **Метод:** `POST`
- **URL:** `/lecture/delete`
- **Тело запроса:**
```json
{
  "id": <id лекции>
}
```
- **Ответ:** сообщение об успешном удалении.
- **Ошибки:** 400.

### Получение лекций по массиву id
- **Метод:** `POST`
- **URL:** `/lecture/get`
- **Тело запроса:**
  ```json
  [
    id1, id2, id3 
  ]
  ```
- **Ответ:**
```json
[
{
  "id":0,// id 
  "title": "Задание",
  "data": [{ /* версия 1 задания */ },
            { /* версия 2 задания */ },
            { /* версия 3 задания */ }
], // структура: список вопросов, файлы и пр.
  "createDate": 1810000000, // время создания (секунды)
  "active": true, // активность задания
  "attempts": 1, // количество попыток (-1 означает отсутствие ограничения)
  "startDate": 1815000000, // время начала, после которого можно начинать попытку (-1 – доступно сразу)
  "endDate": 1816000000, // время окончания попытки (-1 – без ограничения)
  "creator": "", // id создателя (строка)
  "users": [/* id пользователей, которым доступно задание. Если ['all'] – доступно всем */],
  "course": 2 // id курса, к которому относится задание (число)
},
{...}
]
```

- **Ошибки:** 400.

> Если не существует лекции с определенным id, то в массве ответов на на его индексе должен быть пустой объект
> Пример, допустим не был найден объект с id 56 и в массиве он был 5 по порядку
> ```json
> [
> {...},
> { "id":56}, //тогда этот объект тоже должен быть 5 по счету 
> {...}
> ]
> ```

---

## 3. Работа с заданиями

### Создание задания
- **Метод:** `POST`
- **URL:** `/task/create`
- **Тело запроса:**
```json
{
  "id":0,// id 
  "title": "Задание",
  "data": { /* версия 1 задания */ }, 
  "createDate": 1810000000, 
  "active": true, // активность задания
  "attempts": 1, // количество попыток (-1 означает отсутствие ограничения)
  "startDate": 1815000000, // время начала, после которого можно начинать попытку (-1 – доступно сразу)
  "endDate": 1816000000, // время окончания попытки (-1 – без ограничения)
  "creator": "", // id создателя (строка)
  "users": [/* id пользователей, которым доступно задание. Если ['all'] – доступно всем */],
  "course": 2 // id курса, к которому относится задание (число)
}
```
- **Ответ:**
```json
{
  "id": <id лекции>
}
```
- **Ошибки:** 400

### Изменение задания
- **Метод:** `PUT`
- **URL:** `/task/update`
- **Тело запроса:**
```json
{
  "id": <id задания>,
  "title": "Задание",
  "data": { /* структура новой версии задания */ },
...
}
```
- **Ответ:**
```json
{
  "id": <id лекции>
}
```
- **Ошибки:** 400.

### Получение данных о задании
- **Метод:** `POST`
- **URL:** `/task/get`
- **Тело запроса:**
  ```json
  [
    id1, id2, id3 
  ]
  ```
- **Ответ:** объект или массив объектов заданий.
- **Ошибки:** 400

> Если не существует задания с определенным id, то в массве ответов на на его индексе должен быть пустой объект и внутри поле "id" с id которым он не нашел.
> Пример, допустим не был найден объект с id 56 и в массиве он был 5 по порядку
> ```json
> [
> {...},
> { "id":56}, //тогда этот объект тоже должен быть 5 по счету 
> {...}
> ]
> ```

---

## 4. Работа с вопросами

### Создание вопроса
- **Метод:** `POST`
- **URL:** `/question/create`
- **Тело запроса:**
  ```json
  {
    "data": [ { /* версия 1 вопроса */ } ],
    "course": <course_id>,
    "createDate": 1800000000,
    "creator": "<user_id>"
  }
  ```
- **Ответ:** данные созданного вопроса.
- **Ошибки:** 400.

### Изменение вопроса (добавление новой версии)
- **Метод:** `PUT`
- **URL:** `/question/update`
- **Тело запроса:**
  ```json
  {
    "id": <id вопроса>,
    "newVersion": { /* новая версия вопроса */ }
  }
  ```
- **Логика:** новая версия добавляется в конец массива `data`. Сохранение предыдущих версий обязательно.
- **Ответ:** обновленный объект вопроса с добавленной версией.
- **Ошибки:** 400.

### Получение данных вопроса
- **Метод:** `POST`
- **URL:** `/question/get`
- **Тело запроса:**
  ```json
  [
    id1, id2, id3 
  ]
  ```
- **Ответ:** массив объектов вопросов.
```json
[
{
  "id":0,// id 
  "data": [
    {}, // 1-я версия вопроса
    {}, // 2-я версия вопроса
    {}  // 3-я версия вопроса и т.д.
  ],
  "createDate": 1800000000, // время создания (секунды)
  "creator": 3, // id создателя (число)
  "course": 4 // id курса (число)
},
{...}
]
```
- **Ошибки:** 400.

---

## 5. Управление участниками курса

### Добавление/удаление пользователя в курсе
- **Добавление пользователя:**
  - **Метод:** `POST`
  - **URL:** `/course/user/add`
  - **Тело запроса:**
    ```json
    {
      "course":<id>,
      "user": "<user_id>",
      "role": 0 // 0 - студент, а moderator - 1
    }
    ```
  - **Ответ:**
    ```json
    {
      "user": "<user id>",
    }
    ```
  - **Ошибки:** 400.

- **Удаление пользователя:**
  - **Метод:** `POST`
  - **URL:** `/course/user/delete`
  - **Тело запроса:**
    ```json
    {
      "course":<id>,
      "user": "<user_id>",
    }
    ```
  - **Ответ:**
    ```json
    {
      "user": "<user id>",
    }
    ```
- **Ошибки:** 400.

### Изменение статуса пользователя в курсе
- **Добавление пользователя:**
  - **Метод:** `PUT`
  - **URL:** `/course/user/update`
  - **Тело запроса:**
    ```json
    {
      "course":<id>,
      "user": "<user_id>",
      "role": 0 // новая роль
    }
    ```
  - **Ответ:**
    ```json
    {
      "user": "<user id>",
    }
    ```
  - **Ошибки:** 400.

*Замечание:* Каждый пользователь может иметь только один статус в рамках курса. При изменении статуса необходимо обеспечить, чтобы у пользователя не было нескольких ролей одновременно. Владелец курса фиксирован и не может быть изменён после создания курса.

---

## 6. Управление попытками и оценками

### Получение попыток
- **Метод:** `POST`
- **URL:** `/attempts/get`
- **Параметры запроса:**
  ```json
  {
    "typeSearch": "user", // "user" - В ответе должен быть массив всех попыток пользователя, "task" - В ответе должен быть массив всех попыток у которых <task_id>, "course" - В ответе должен быть массив всех попыток у которых <course_id>, "ids" - значить на вход подется массив id и нужно вывести массив
    "task": <task_id>,
    "course": <course_id>,
    "user": "<user_id>",
    "ids":[id1,id2,id3]
  }
  ```
- **Ответ:**
```json
[
{
  "id":0,// id 
  "data": {}, // структура, содержащая ответы на задание
  "startDate": 1810000000, // время начала попытки (секунды)
  "endDate": 1816000000, // время окончания попытки (секунды, если попытка активна – -1)
  "finished": true, // статус завершенности попытки
  "user": "", // id студента (строка)
  "task": 3, // id задания (число)
  "course": 2 // id курса (число)
},
{...}
]
```
- **Ошибки:** 400.
> Если не существует задания с определенным id, то в массве ответов на на его индексе должен быть пустой объект и внутри поле "id" с id которым он не нашел.
> Пример, допустим не был найден объект с id 56 и в массиве он был 5 по порядку
> ```json
> [
> {...},
> { "id":56}, //тогда этот объект тоже должен быть 5 по счету 
> {...}
> ]
> ```


### Начало новой попытки
- **Метод:** `POST`
- **URL:** `/attempt/add`
- **Тело запроса:**
  ```json
  {
    "user": "<user_id>",
    "task": <task_id>,
    "course": <course_id>,
    "startDate": 1810000000,
  }
  ```
- **Логика:** Перед созданием новой попытки сервер проверяет:
  - Отсутствие активной (незавершённой) попытки для данного задания.
  - Соответствие временным ограничениям: задание может иметь ограничения по времени (attemptsDuration) и интервалам (startDate, endDate).
  - Количество допустимых попыток.
- **Ответ:**
  ```json
  {
    "attempt": <attempt_id>,
  }
  ```
- **Ошибки:** 400

### Изменение (обновление) попытки
- **Метод:** `PUT`
- **URL:** `/attempt/update`
- **Тело запроса:**
  ```json
  {
    "data": { /* обновленные ответы */ }
  }
  ```
- **Ответ:**
 ```json
  {
    "attempt": <attempt_id>,
  }
  ```
- **Ошибки:** 400

### Завершение попытки
- **Метод:** `POST`
- **URL:** `/attempt/finish`
- **Логика:** Фиксируется конечное время попытки, статус `finished` меняется на `true`.
- **Ответ:**
   ```json
  {
    "attempt": <attempt_id>,
  }
  ```
- **Ошибки:** 400

---

# Обработка ошибок

В ответах сервера предусмотрены следующие коды ошибок:
- **400 Bad Request:** Невалидные или неполные данные запроса.
- **500 Internal Server Error:** Необработанная ошибка сервера.

